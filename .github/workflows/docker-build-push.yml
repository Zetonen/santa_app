name: üê≥ Docker Build and Push (Next.js Frontend)

# 1. –î–æ–∑–≤–æ–ª–∏: —á–∏—Ç–∞–Ω–Ω—è –∫–æ–¥—É —Ç–∞ –∑–∞–ø–∏—Å —É —Ä–µ—î—Å—Ç—Ä
permissions:
  contents: read
  packages: write

on:
  # –ó–∞–ø—É—Å–∫–∞—î–º–æ –≤—Ä—É—á–Ω—É –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –≤–∫–∞–∑–∞—Ç–∏ —Ç–µ–≥
  workflow_dispatch:
    inputs:
      tag:
        description: 'Docker Image Tag (e.g., v1.0.0 or latest)'
        required: true
        default: 'latest'
        type: string
  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –æ–±'—î–¥–Ω–∞–Ω–Ω—ñ —É –≥—ñ–ª–∫—É 'main'
  push:
    branches:
      - main

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    
    env:
      # –í–∞—à–µ —ñ–º'—è –≤ Docker Hub —Ç–∞ –Ω–∞–∑–≤–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
      DOCKER_IMAGE_NAME: olk005430/santa
      
    steps:
    
    # 1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
    - name: Checkout repository
      uses: actions/checkout@v4

    # 2. –í—Ö—ñ–¥ —É Docker Hub
    - name: Log in to Docker Hub
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.is_token_for_docker_hub }}
        
    # 3. –§–æ—Ä–º—É—î–º–æ –ø–æ–≤–Ω–∏–π —Ç–µ–≥ –æ–±—Ä–∞–∑—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, olk005430/santa:v1.0.0)
    - name: Prepare Image Tag
      id: prepare_tag
      run: |
        TAG=${{ github.event.inputs.tag || 'latest' }}
        IMAGE_TAG=${{ env.DOCKER_IMAGE_NAME }}:${{ TAG }}
        echo "image_tag=$IMAGE_TAG" >> $GITHUB_OUTPUT

    # 4. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Node.js —Ç–∞ –∫–µ—à—É–≤–∞–Ω–Ω—è
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm' 

    # 5. –ó–±—ñ—Ä–∫–∞ —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –æ–±—Ä–∞–∑—É
    - name: Build and push Docker image
      uses: docker/build-push-action@v5
      with:
        context: .
        push: true
        tags: ${{ steps.prepare_tag.outputs.image_tag }}
        # Build Argument —Ç–µ–ø–µ—Ä –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ 3000 –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
